<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sketch Pad</title>
    <style>
        body { margin: 0; background: #ffffff; overflow: hidden; touch-action: none; font-family: sans-serif; }
        #canvas { width: 100vw; height: 100vh; display: block; }

        /* æ”¹è‰¯å·¥å…·åˆ—ï¼šæ›´å¤šé¡è‰²ã€ç´”åœ–ç¤º */
        .toolbar {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%);
            display: flex; gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 18px; border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 100; align-items: center;
        }

        .color-btn { width: 24px; height: 24px; border-radius: 50%; border: 1px solid #ddd; cursor: pointer; transition: transform 0.1s; }
        .color-btn:active { transform: scale(0.9); }
        
        .divider { width: 1px; height: 24px; background: #ddd; margin: 0 5px; }

        .icon-btn { 
            background: none; border: none; font-size: 20px; cursor: pointer; 
            padding: 5px; display: flex; align-items: center; justify-content: center;
        }

        /* é è¨€å®¹å™¨ï¼šç½®ä¸­ä¸”ä¸é®æ“‹ UI */
        #prediction-layer {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none; z-index: 10;
            text-align: center;
        }

        .prediction { display: none; font-size: 100px; font-weight: bold; color: #000; }
        .show-now { display: block !important; }
    </style>
</head>
<body>

    <canvas id="canvas"></canvas>

    <div class="toolbar" id="toolbar">
        <div class="color-btn" style="background: #000000;" onclick="setProp('#000000', 3)"></div>
        <div class="color-btn" style="background: #ff4757;" onclick="setProp('#ff4757', 3)"></div>
        <div class="color-btn" style="background: #2ed573;" onclick="setProp('#2ed573', 3)"></div>
        <div class="color-btn" style="background: #1e90ff;" onclick="setProp('#1e90ff', 3)"></div>
        <div class="color-btn" style="background: #ffa502;" onclick="setProp('#ffa502', 3)"></div>
        <div class="color-btn" style="background: #a29bfe;" onclick="setProp('#a29bfe', 3)"></div>
        
        <div class="divider"></div>
        
        <button class="icon-btn" onclick="setProp('#ffffff', 30)">ğŸ§¼</button>
        <button class="icon-btn" onclick="clearCanvas()">ğŸ—‘ï¸</button>
    </div>

    <div id="prediction-layer">
        <div id="res-A" class="prediction">ğŸ</div>
        <div id="res-B" class="prediction">ğŸŒ</div>
        <div id="res-C" class="prediction">ğŸ‡</div>
        <div id="res-D" class="prediction">ğŸ‰</div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let isDrawing = false;
        let lastX = 0, lastY = 0;
        let isFaceDown = false;
        let predictionTriggered = false;
        let sensorActive = false;

        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.lineJoin = "round";
            ctx.lineCap = "round";
            setProp('#000000', 3);
        }

        function setProp(color, width) {
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            // å¦‚æœæ˜¯åœ¨é è¨€å¾Œåˆ‡æ›é¡è‰²ï¼Œæœƒéš±è—ä¹‹å‰çš„é è¨€
            if (predictionTriggered) resetState();
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            resetState();
        }

        function resetState() {
            document.querySelectorAll('.prediction').forEach(el => el.classList.remove('show-now'));
            predictionTriggered = false;
        }

        function activateSensors() {
            if (sensorActive) return;
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(reg => {
                    if (reg === 'granted') {
                        window.addEventListener('deviceorientation', handleMotion, true);
                        sensorActive = true;
                    }
                });
            } else {
                window.addEventListener('deviceorientation', handleMotion, true);
                sensorActive = true;
            }
        }

        // è§¸æ§ç¹ªåœ–
        canvas.addEventListener('pointerdown', (e) => {
            activateSensors();
            if (predictionTriggered) resetState();
            isDrawing = true;
            [lastX, lastY] = [e.clientX, e.clientY];
        });

        canvas.addEventListener('pointermove', (e) => {
            if (!isDrawing) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.clientX, e.clientY);
            ctx.stroke();
            [lastX, lastY] = [e.clientX, e.clientY];
        });

        canvas.addEventListener('pointerup', () => isDrawing = false);

        // é«˜é€Ÿé™€èºå„€é‚è¼¯
        function handleMotion(event) {
            if (predictionTriggered) return;
            
            let beta = event.beta;
            let gamma = event.gamma;

            // åˆ¤æ–·è¢å¹•æœä¸‹ (é–¾å€¼è¨­ç‚º 155 åº¦å¢åŠ éˆæ•åº¦)
            if (Math.abs(beta) > 155) {
                isFaceDown = true;
            }

            // ç¿»è½‰ç¬é–“è§¸ç™¼ (ç•¶ beta é™å› 60 åº¦ä»¥å…§ç«‹å³åˆ¤å®š)
            if (isFaceDown && Math.abs(beta) < 60) {
                predictionTriggered = true;
                isFaceDown = false;
                
                // ç«‹å³æ¸…é™¤åŸæœ¬çš„ã€Œè‰ç¨¿ã€
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // å³æ™‚åˆ¤å®šæ–¹å‘
                let id = '';
                if (gamma > 30) id = 'res-A';      // å³ç¿»
                else if (gamma < -30) id = 'res-B'; // å·¦ç¿»
                else if (beta < -10) id = 'res-C';  // ä¸Šç¿»
                else id = 'res-D';                  // ä¸‹ç¿»

                document.getElementById(id).classList.add('show-now');
            }
        }

        window.addEventListener('resize', init);
        init();
    </script>
</body>
</html>