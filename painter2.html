<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic Painter Pro</title>
    <style>
        body { margin: 0; background: #fff; font-family: sans-serif; overflow: hidden; touch-action: none; }
        #canvas { width: 100vw; height: 100vh; display: block; }
        #status { position: fixed; top: 10px; left: 10px; color: #ccc; font-size: 12px; pointer-events: none; }
        
        /* é è¨€åœ–ç‰‡æ¨£å¼ï¼šé è¨­éš±è— */
        .prediction {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80%; display: none;
            opacity: 0; transition: opacity 1s ease-in;
        }
        
        /* æ‰‹å¯«ç­†è·¡å‹•ç•«æ•ˆæœ */
        .show-drawing { display: block; opacity: 1; animation: draw 2s ease-out; }
        @keyframes draw { from { filter: blur(10px); opacity: 0; } to { filter: blur(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="status">å°ç•«å®¶æ¨¡å¼å·²å•Ÿå‹•...</div>
    <canvas id="canvas"></canvas>

    <div id="res-A" class="prediction"><h1>ğŸ (ç‰©å“ A)</h1></div>
    <div id="res-B" class="prediction"><h1>ğŸŒ (ç‰©å“ B)</h1></div>
    <div id="res-C" class="prediction"><h1>ğŸ‡ (ç‰©å“ C)</h1></div>
    <div id="res-D" class="prediction"><h1>ğŸ‰ (ç‰©å“ D)</h1></div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let isFaceDown = false;
        let predictionTriggered = false;

        // è¨­å®šç•«å¸ƒå°ºå¯¸
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // ç°¡å–®çš„å°ç•«å®¶åŠŸèƒ½ (å‡è£åœ¨ç•«ç•«)
        canvas.addEventListener('pointermove', (e) => {
            if (predictionTriggered) return;
            ctx.fillStyle = "#333";
            ctx.beginPath();
            ctx.arc(e.clientX, e.clientY, 2, 0, Math.PI * 2);
            ctx.fill();
        });

        // è«‹æ±‚æ¬Šé™ (iOS å¿…å‚™)
        function requestPermission() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().catch(console.error);
            }
        }
        canvas.addEventListener('click', requestPermission);

        window.addEventListener('deviceorientation', (event) => {
            if (predictionTriggered) return;

            let beta = event.beta;   // Xè»¸ (å‰å¾Œç¿»è½‰)
            let gamma = event.gamma; // Yè»¸ (å·¦å³ç¿»è½‰)

            // åˆ¤æ–·è¢å¹•æ˜¯å¦æœä¸‹ (é€šå¸¸ beta æ¥è¿‘ 180 æˆ– -180)
            if (Math.abs(beta) > 160) {
                isFaceDown = true;
                document.getElementById('status').innerText = "é è¨€å·²é–å®š...";
            }

            // ç•¶æ‰‹æ©Ÿå¾æœä¸‹ç¿»è½‰å›æœä¸Š (beta æ¥è¿‘ 0)
            if (isFaceDown && Math.abs(beta) < 30) {
                isFaceDown = false;
                predictionTriggered = true; // é˜²æ­¢é‡è¤‡è§¸ç™¼

                // åˆ¤æ–·ç¿»è½‰æ–¹å‘é‚è¼¯
                if (gamma > 40) {
                    showResult('res-A'); // ç”±å·¦å‘å³ç¿» (Gamma æ­£å€¼)
                } else if (gamma < -40) {
                    showResult('res-B'); // ç”±å³å‘å·¦ç¿» (Gamma è² å€¼)
                } else if (beta < -20) {
                    showResult('res-C'); // ç”±ä¸‹å‘ä¸Šç¿» (Beta è² å‘)
                } else {
                    showResult('res-D'); // ç”±ä¸Šå‘ä¸‹ç¿» (Beta æ­£å‘)
                }
            }
        });

        function showResult(id) {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // æ¸…ç©ºç•«å¸ƒ
            const el = document.getElementById(id);
            el.classList.add('show-drawing');
            document.getElementById('status').style.display = 'none';
        }
    </script>
</body>
</html>